<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cocco's D&D Universe</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=UnifrakturMaguntia&family=Cormorant+Garamond:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="root"></div>
  
  <script type="module">
    import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
    import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
    
    // Mock storage API for development/local testing
    // When deployed to claude.ai artifacts, window.storage will be provided
    // This fallback uses localStorage for testing
    if (!window.storage) {
      console.log('Using localStorage fallback for storage');
      window.storage = {
        async get(key) {
          const value = localStorage.getItem(key);
          return value ? { key, value, shared: false } : null;
        },
        async set(key, value) {
          localStorage.setItem(key, value);
          return { key, value, shared: false };
        },
        async delete(key) {
          localStorage.removeItem(key);
          return { key, deleted: true, shared: false };
        },
        async list(prefix) {
          const keys = Object.keys(localStorage).filter(k => !prefix || k.startsWith(prefix));
          return { keys, prefix, shared: false };
        }
      };
    }
    
    const { createElement: h } = React;

    let idCounter = 0;
    const uniqueId = () => `${Date.now()}_${idCounter++}_${Math.random().toString(36).slice(2, 7)}`;

    // Homepage Component
    function HomePage({ onEnterCampaign }) {
      const [activeMap, setActiveMap] = useState(1);

      const [mapsLoaded, setMapsLoaded] = useState(false);

      useEffect(() => {
        // Preload the second map image so it's ready before the first crossfade
        const img = new Image();
        img.src = 'background-map-2.png';
        img.onload = () => setMapsLoaded(true);
        // Start crossfading regardless after a short delay
        const fallback = setTimeout(() => setMapsLoaded(true), 2000);
        return () => clearTimeout(fallback);
      }, []);

      useEffect(() => {
        if (!mapsLoaded) return;
        const interval = setInterval(() => {
          setActiveMap(prev => prev === 1 ? 2 : 1);
        }, 4000);
        return () => clearInterval(interval);
      }, [mapsLoaded]);

      return h('div', { className: 'homepage' },
        h('div', { className: 'hero-wrapper' },
          h('div', { className: `map-bg map-bg-1 ${activeMap === 1 ? 'active' : 'hidden'}` }),
          h('div', { className: `map-bg map-bg-2 ${activeMap === 2 ? 'active' : 'hidden'}` }),
          h('div', { className: 'hero-section' },
            h('div', { className: 'hero-text' },
              h('h1', { className: 'main-title' }, 'Welcome to Cocco\'s D&D Universe'),
              h('p', { className: 'subtitle' },
                "Your gateway to epic adventures. Track your journey, relive memorable sessions, connect with fellow adventurers, discover NPCs and locations, earn achievements, and explore the worlds we're building together."
              )
            ),
            h('div', { className: 'hero-portrait' },
              h('img', {
                src: 'cocco-portrait.png',
                alt: 'Cocco the Bard',
                className: 'dm-portrait',
                loading: 'eager'
              })
            )
          )
        ),
        h('div', { className: 'homepage-divider' }),
        h('div', { className: 'campaigns-wrapper' },
          h('div', { className: 'campaigns-section' },
            h('h2', { className: 'section-title' }, 'Pick Your Universe'),
            h('div', { className: 'campaign-cards' },
              h('div', {
                className: 'campaign-card curse-of-strahd',
                onClick: () => onEnterCampaign('cos')
              },
                h('h3', null, 'Curse of Strahd'),
                h('p', { className: 'campaign-tagline' }, 'Enter the Mists of Barovia'),
                h('div', { className: 'card-overlay' })
              ),
              h('div', {
                className: 'campaign-card waning-wonder',
                onClick: () => onEnterCampaign('tww')
              },
                h('h3', null, 'The Waning Wonder'),
                h('p', { className: 'campaign-tagline' }, 'Uncover Divine Mysteries in Sefara'),
                h('div', { className: 'card-overlay' })
              )
            )
          ),
          h('div', { className: 'resources-section' },
            h('p', { className: 'resources-text' },
              'Playing D&D for the first time? ',
              h('span', { className: 'wip-tag' }, '(WIP)'),
              h('br'),
              'Check out these resources first'
            )
          )
        )
      );
    }

    // Password Gate Component
    function PasswordGate({ campaign, onUnlock, onBack }) {
      const [password, setPassword] = useState('');
      const [error, setError] = useState(false);

      const correctPassword = campaign === 'cos' ? 'strahd' : 'wonder';
      const campaignName = campaign === 'cos' ? 'Curse of Strahd' : 'The Waning Wonder';

      const handleSubmit = (e) => {
        e.preventDefault();
        if (password.toLowerCase() === correctPassword) {
          onUnlock();
          setError(false);
        } else {
          setError(true);
          setPassword('');
        }
      };

      return h('div', { className: `password-gate ${campaign}` },
        h('div', { className: 'password-box' },
          h('h2', null, campaignName),
          h('p', null, 'Enter the password to access this campaign'),
          h('form', { onSubmit: handleSubmit },
            h('input', {
              type: 'password',
              value: password,
              onChange: (e) => setPassword(e.target.value),
              placeholder: 'Password',
              className: error ? 'error' : '',
              autoFocus: true
            }),
            error && h('p', { className: 'error-message' }, 'Incorrect password. Try again.'),
            h('button', { type: 'submit' }, 'Enter')
          ),
          h('button', {
            className: 'back-button',
            onClick: onBack
          }, 'â† Back to Home')
        )
      );
    }

    // Campaign Dashboard Component
    function CampaignDashboard({ campaign, onBack }) {
      const [activeTab, setActiveTab] = useState(campaign === 'tww' ? 'home' : 'recaps');
      const [recaps, setRecaps] = useState([]);
      const [comments, setComments] = useState([]);
      const [achievements, setAchievements] = useState([]);
      const [npcs, setNpcs] = useState([]);
      const [loading, setLoading] = useState(true);

      const campaignName = campaign === 'cos' ? 'Curse of Strahd' : 'The Waning Wonder';
      const storagePrefix = campaign === 'cos' ? 'cos' : 'tww';

      useEffect(() => {
        loadData();
      }, []);

      const loadData = async () => {
        const loadKey = async (key, setter) => {
          try {
            const data = await window.storage.get(`${storagePrefix}_${key}`);
            if (data?.value) setter(JSON.parse(data.value));
          } catch (error) {
            console.error(`Failed to load ${key}:`, error);
          }
        };

        await Promise.all([
          loadKey('recaps', setRecaps),
          loadKey('comments', setComments),
          loadKey('achievements', setAchievements),
          loadKey('npcs', setNpcs),
        ]);
        setLoading(false);
      };

      const saveData = async (key, data, setter) => {
        try {
          await window.storage.set(`${storagePrefix}_${key}`, JSON.stringify(data));
          setter(data);
        } catch (error) {
          console.error(`Failed to save ${key}:`, error);
          alert(`Failed to save ${key}. Please try again.`);
        }
      };

      const saveRecaps = (newRecaps) => saveData('recaps', newRecaps, setRecaps);
      const saveComments = (newComments) => saveData('comments', newComments, setComments);
      const saveAchievements = (newAchievements) => saveData('achievements', newAchievements, setAchievements);
      const saveNpcs = (newNpcs) => saveData('npcs', newNpcs, setNpcs);

      if (loading) {
        return h('div', { className: `campaign-dashboard ${campaign}` }, 'Loading...');
      }

      return h('div', { className: `campaign-dashboard ${campaign}` },
        h('header', { className: 'campaign-header' },
          h('button', { className: 'back-button', onClick: onBack }, 'â† Back to Home'),
          h('h1', null, campaignName)
        ),
        h('nav', { className: 'campaign-nav' },
          campaign === 'tww' && h('button', {
            className: activeTab === 'home' ? 'active' : '',
            onClick: () => setActiveTab('home')
          }, 'Home'),
          h('button', {
            className: activeTab === 'recaps' ? 'active' : '',
            onClick: () => setActiveTab('recaps')
          }, 'Session Recaps'),
          h('button', { 
            className: activeTab === 'comments' ? 'active' : '',
            onClick: () => setActiveTab('comments')
          }, 'Message Board'),
          h('button', { 
            className: activeTab === 'achievements' ? 'active' : '',
            onClick: () => setActiveTab('achievements')
          }, 'Achievements'),
          h('button', { 
            className: activeTab === 'npcs' ? 'active' : '',
            onClick: () => setActiveTab('npcs')
          }, 'NPCs'),
          h('button', { 
            className: activeTab === 'maps' ? 'active' : '',
            onClick: () => setActiveTab('maps')
          }, 'Maps')
        ),
        h('main', { className: 'campaign-content' },
          activeTab === 'home' && campaign === 'tww' && h(TWWHomeTab, { onNavigate: setActiveTab }),
          activeTab === 'recaps' && h(RecapsTab, { recaps, onSave: saveRecaps }),
          activeTab === 'comments' && h(CommentsTab, { comments, onSave: saveComments }),
          activeTab === 'achievements' && h(AchievementsTab, { achievements, onSave: saveAchievements }),
          activeTab === 'npcs' && h(NpcsTab, { npcs, onSave: saveNpcs }),
          activeTab === 'maps' && h(MapsTab, { campaign })
        )
      );
    }

    // Recaps Tab
    function RecapsTab({ recaps, onSave }) {
      const [isAdding, setIsAdding] = useState(false);
      const [newRecap, setNewRecap] = useState({ session: '', title: '', content: '', date: '' });

      const handleAdd = () => {
        if (newRecap.session && newRecap.title && newRecap.content) {
          const recap = {
            ...newRecap,
            id: uniqueId(),
            date: newRecap.date || new Date().toLocaleDateString()
          };
          onSave([recap, ...recaps]);
          setNewRecap({ session: '', title: '', content: '', date: '' });
          setIsAdding(false);
        }
      };

      const handleDelete = (id) => {
        if (confirm('Are you sure you want to delete this recap?')) {
          onSave(recaps.filter(r => r.id !== id));
        }
      };

      return h('div', { className: 'tab-content' },
        h('div', { className: 'tab-header' },
          h('h2', null, 'Session Recaps'),
          h('button', { 
            className: 'add-button',
            onClick: () => setIsAdding(!isAdding)
          }, isAdding ? 'Cancel' : '+ Add Recap')
        ),
        isAdding && h('div', { className: 'add-form' },
          h('input', {
            type: 'text',
            placeholder: 'Session Number (e.g., Session 1)',
            value: newRecap.session,
            onChange: (e) => setNewRecap({...newRecap, session: e.target.value})
          }),
          h('input', {
            type: 'text',
            placeholder: 'Session Title',
            value: newRecap.title,
            onChange: (e) => setNewRecap({...newRecap, title: e.target.value})
          }),
          h('input', {
            type: 'date',
            value: newRecap.date,
            onChange: (e) => setNewRecap({...newRecap, date: e.target.value})
          }),
          h('textarea', {
            placeholder: 'Write your session recap here...',
            value: newRecap.content,
            onChange: (e) => setNewRecap({...newRecap, content: e.target.value}),
            rows: 10
          }),
          h('button', { className: 'save-button', onClick: handleAdd }, 'Save Recap')
        ),
        h('div', { className: 'recaps-list' },
          recaps.length === 0
            ? h('p', { className: 'empty-state' }, 'No recaps yet. Add your first session recap!')
            : recaps.map(recap => 
                h('div', { key: recap.id, className: 'recap-card' },
                  h('div', { className: 'recap-header' },
                    h('div', null,
                      h('h3', null, `${recap.session}: ${recap.title}`),
                      h('p', { className: 'recap-date' }, recap.date)
                    ),
                    h('button', { 
                      className: 'delete-button',
                      onClick: () => handleDelete(recap.id)
                    }, 'Delete')
                  ),
                  h('div', { className: 'recap-content' }, recap.content)
                )
              )
        )
      );
    }

    // Comments Tab
    function CommentsTab({ comments, onSave }) {
      const [newComment, setNewComment] = useState({ author: '', message: '' });

      const handleAdd = () => {
        if (newComment.author && newComment.message) {
          const comment = {
            ...newComment,
            id: uniqueId(),
            timestamp: new Date().toLocaleString()
          };
          onSave([...comments, comment]);
          setNewComment({ author: '', message: '' });
        }
      };

      const handleDelete = (id) => {
        if (confirm('Are you sure you want to delete this message?')) {
          onSave(comments.filter(c => c.id !== id));
        }
      };

      return h('div', { className: 'tab-content' },
        h('h2', null, 'Message Board'),
        h('div', { className: 'add-form comment-form' },
          h('input', {
            type: 'text',
            placeholder: 'Your name',
            value: newComment.author,
            onChange: (e) => setNewComment({...newComment, author: e.target.value})
          }),
          h('textarea', {
            placeholder: 'Write a message...',
            value: newComment.message,
            onChange: (e) => setNewComment({...newComment, message: e.target.value}),
            rows: 4
          }),
          h('button', { className: 'save-button', onClick: handleAdd }, 'Post Message')
        ),
        h('div', { className: 'comments-list' },
          comments.length === 0
            ? h('p', { className: 'empty-state' }, 'No messages yet. Be the first to post!')
            : comments.map(comment =>
                h('div', { key: comment.id, className: 'comment-card' },
                  h('div', { className: 'comment-header' },
                    h('strong', null, comment.author),
                    h('span', { className: 'comment-time' }, comment.timestamp),
                    h('button', {
                      className: 'delete-button small',
                      onClick: () => handleDelete(comment.id)
                    }, 'Ã—')
                  ),
                  h('p', null, comment.message)
                )
              )
        )
      );
    }

    // Achievements Tab
    function AchievementsTab({ achievements, onSave }) {
      const [isAdding, setIsAdding] = useState(false);
      const [newAchievement, setNewAchievement] = useState({ title: '', description: '', date: '' });

      const handleAdd = () => {
        if (newAchievement.title && newAchievement.description) {
          const achievement = {
            ...newAchievement,
            id: uniqueId(),
            date: newAchievement.date || new Date().toLocaleDateString()
          };
          onSave([achievement, ...achievements]);
          setNewAchievement({ title: '', description: '', date: '' });
          setIsAdding(false);
        }
      };

      const handleDelete = (id) => {
        if (confirm('Are you sure you want to delete this achievement?')) {
          onSave(achievements.filter(a => a.id !== id));
        }
      };

      return h('div', { className: 'tab-content' },
        h('div', { className: 'tab-header' },
          h('h2', null, 'Party Achievements'),
          h('button', {
            className: 'add-button',
            onClick: () => setIsAdding(!isAdding)
          }, isAdding ? 'Cancel' : '+ Add Achievement')
        ),
        isAdding && h('div', { className: 'add-form' },
          h('input', {
            type: 'text',
            placeholder: 'Achievement Title',
            value: newAchievement.title,
            onChange: (e) => setNewAchievement({...newAchievement, title: e.target.value})
          }),
          h('input', {
            type: 'date',
            value: newAchievement.date,
            onChange: (e) => setNewAchievement({...newAchievement, date: e.target.value})
          }),
          h('textarea', {
            placeholder: 'Achievement description...',
            value: newAchievement.description,
            onChange: (e) => setNewAchievement({...newAchievement, description: e.target.value}),
            rows: 4
          }),
          h('button', { className: 'save-button', onClick: handleAdd }, 'Save Achievement')
        ),
        h('div', { className: 'achievements-grid' },
          achievements.length === 0
            ? h('p', { className: 'empty-state' }, 'No achievements yet. Your legendary deeds await!')
            : achievements.map(achievement =>
                h('div', { key: achievement.id, className: 'achievement-card' },
                  h('div', { className: 'achievement-icon' }, 'ðŸ†'),
                  h('h3', null, achievement.title),
                  h('p', { className: 'achievement-date' }, achievement.date),
                  h('p', null, achievement.description),
                  h('button', {
                    className: 'delete-button small',
                    onClick: () => handleDelete(achievement.id)
                  }, 'Delete')
                )
              )
        )
      );
    }

    // NPCs Tab
    function NpcsTab({ npcs, onSave }) {
      const [isAdding, setIsAdding] = useState(false);
      const [newNpc, setNewNpc] = useState({ name: '', title: '', location: '', description: '', status: 'alive' });

      const handleAdd = () => {
        if (newNpc.name && newNpc.description) {
          const npc = { ...newNpc, id: uniqueId() };
          onSave([...npcs, npc]);
          setNewNpc({ name: '', title: '', location: '', description: '', status: 'alive' });
          setIsAdding(false);
        }
      };

      const handleDelete = (id) => {
        if (confirm('Are you sure you want to delete this NPC?')) {
          onSave(npcs.filter(n => n.id !== id));
        }
      };

      return h('div', { className: 'tab-content' },
        h('div', { className: 'tab-header' },
          h('h2', null, 'NPCs & Characters'),
          h('button', {
            className: 'add-button',
            onClick: () => setIsAdding(!isAdding)
          }, isAdding ? 'Cancel' : '+ Add NPC')
        ),
        isAdding && h('div', { className: 'add-form' },
          h('input', {
            type: 'text',
            placeholder: 'NPC Name',
            value: newNpc.name,
            onChange: (e) => setNewNpc({...newNpc, name: e.target.value})
          }),
          h('input', {
            type: 'text',
            placeholder: 'Title/Role (e.g., Innkeeper, Lord, Merchant)',
            value: newNpc.title,
            onChange: (e) => setNewNpc({...newNpc, title: e.target.value})
          }),
          h('input', {
            type: 'text',
            placeholder: 'Location',
            value: newNpc.location,
            onChange: (e) => setNewNpc({...newNpc, location: e.target.value})
          }),
          h('select', {
            value: newNpc.status,
            onChange: (e) => setNewNpc({...newNpc, status: e.target.value})
          },
            h('option', { value: 'alive' }, 'Alive'),
            h('option', { value: 'deceased' }, 'Deceased'),
            h('option', { value: 'unknown' }, 'Unknown')
          ),
          h('textarea', {
            placeholder: 'Description, personality, notes...',
            value: newNpc.description,
            onChange: (e) => setNewNpc({...newNpc, description: e.target.value}),
            rows: 6
          }),
          h('button', { className: 'save-button', onClick: handleAdd }, 'Save NPC')
        ),
        h('div', { className: 'npcs-grid' },
          npcs.length === 0
            ? h('p', { className: 'empty-state' }, 'No NPCs recorded yet. Meet someone interesting!')
            : npcs.map(npc =>
                h('div', { key: npc.id, className: 'npc-card' },
                  h('div', { className: 'npc-header' },
                    h('h3', null, npc.name),
                    h('span', { className: `status-badge ${npc.status}` }, npc.status)
                  ),
                  npc.title && h('p', { className: 'npc-title' }, npc.title),
                  npc.location && h('p', { className: 'npc-location' }, `ðŸ“ ${npc.location}`),
                  h('p', { className: 'npc-description' }, npc.description),
                  h('button', {
                    className: 'delete-button',
                    onClick: () => handleDelete(npc.id)
                  }, 'Delete')
                )
              )
        )
      );
    }

    // Maps Tab
    function MapsTab({ campaign }) {
      return h('div', { className: 'tab-content' },
        h('h2', null, 'Maps & Locations'),
        h('p', { className: 'empty-state' }, 'Maps coming soon! You can add map images here later.')
      );
    }

    // TWW Home Tab
    function TWWHomeTab({ onNavigate }) {
      const scrollTo = (id) => {
        const el = document.getElementById(id);
        if (el) el.scrollIntoView({ behavior: 'smooth' });
      };

      const [carouselIndex, setCarouselIndex] = useState(0);
      const [hovered, setHovered] = useState(false);
      const timerRef = React.useRef(null);

      const partyMembers = [
        {
          name: 'Iodem Lalivero',
          image: 'io-pc.png',
          player: 'Skye',
          race: 'Human',
          level: 4,
          classInfo: 'Sorcerer \u2014 Dreamweave Sorcery',
          hook: 'He walks with one foot in waking, and one foot in the place where promises go to die.',
          bio: 'Iodem\'s magic does not crash into the world like flame or thunder. It arrives like a thread \u2014 a tug at the edge of thought, a pattern in the corner of the eye, a dream that remembers you. In Sefara, where miracles once felt as common as sunrise, his gift is both comfort and warning: wonder may be fading, but it is not gone. It is changing, becoming stranger \u2014 more selective \u2014 more personal.'
        },
        {
          name: "Kord'ak",
          image: 'kordak-pc.png',
          player: 'Mila',
          race: 'Orc',
          level: 6,
          classInfo: 'Barbarian \u2014 Wild Heart / Druid \u2014 Circle of the Moon',
          hook: "A war cry with a soul \u2014 nature's fury wearing a name.",
          bio: "Kord'ak is power given shape: the kind that breaks doors, splits shields, and dares the world to flinch first. But beneath the rage is something older and steadier \u2014 the wilderness, watching through mortal eyes. When he calls upon the wild, it is not a performance. It is recognition. A pact written in breath and blood: if the world is fraying, then someone must be strong enough to hold it."
        },
        {
          name: 'Lucien',
          image: 'lucien-pc.png',
          player: 'Eduardo',
          race: 'Human \u2014 Vampire Spawn',
          level: 4,
          classInfo: 'Paladin \u2014 Oath of Redemption',
          hook: 'A monster who chose mercy \u2014 and pays for that choice every day.',
          bio: 'Lucien carries a curse that the world loves to fear, and an oath the world loves to doubt. He is undead, hungry, and haunted \u2014 yet he has sworn not to destroy the wicked, but to save them, even when salvation is harder than a blade. In a land built on faith, Lucien stands as a living contradiction: proof that redemption is real... and proof that it costs more than anyone wants to admit.'
        },
        {
          name: 'Scales',
          image: 'scales-pc.png',
          player: 'Matthew',
          race: 'Divineforged',
          level: 4,
          classInfo: 'Cleric \u2014 Grave Domain',
          hook: "A sacred instrument of endings \u2014 here to keep the world's balance from snapping.",
          bio: 'Scales is the quiet certainty at the edge of every life. Not cruel. Not kind. True. A being shaped by divine purpose, walking among mortals as both warning and witness. Where others see the grave as terror, Scales sees it as structure: the mercy of completion, the sanctity of the boundary between what must end and what must continue.'
        },
        {
          name: 'Vazriel "Vaz" Caelithra',
          image: 'vaz-pc.png',
          player: 'Laura',
          race: 'Tiefling \u2014 Bloodline of Glasya',
          level: 4,
          classInfo: 'Rogue \u2014 Arcane Trickster',
          hook: 'A smile like a secret \u2014 hands quick enough to steal certainty itself.',
          bio: "Vaz moves like a rumor that learned how to pick locks. He is clever, charming, and just magical enough to make you doubt your own senses. In a world where wonder is vanishing, some people chase it. Some people pray for it. Vaz? Vaz survives it. If there's something left worth having \u2014 truth, power, relic, or fate \u2014 he's the sort to take it first... and decide what it means later."
        }
      ];

      const count = partyMembers.length;

      useEffect(() => {
        if (hovered) return;
        timerRef.current = setInterval(() => {
          setCarouselIndex(prev => (prev + 1) % count);
        }, 3500);
        return () => clearInterval(timerRef.current);
      }, [hovered, count]);

      const goLeft = () => setCarouselIndex(prev => (prev - 1 + count) % count);
      const goRight = () => setCarouselIndex(prev => (prev + 1) % count);

      // Compute position offset from center for each card
      const getPos = (i) => {
        let diff = i - carouselIndex;
        if (diff > Math.floor(count / 2)) diff -= count;
        if (diff < -Math.floor(count / 2)) diff += count;
        return diff;
      };

      return h('div', { className: 'tww-home' },
        // Hero Section
        h('section', { className: 'tww-hero-section', id: 'tww-hero' },
          h('h2', null, 'The Waning Wonder'),
          h('p', { className: 'tww-hero-tagline' }, "Magic was once the world's breath. Now the world is holding it."),
          h('div', { className: 'tww-hero-teaser' },
            h('p', null, 'In Sefara, faith once moved stone, soothed storms, and set relics singing.'),
            h('p', null, 'Now prayers return unanswered, miracles falter, and the laws of reality begin to fray.'),
            h('p', null, 'Something vast has stirred \u2014 ancient, patient, and hungry for the silence between gods.')
          ),
          h('div', { className: 'tww-hero-buttons' },
            h('button', { className: 'tww-btn', onClick: () => scrollTo('tww-premise') }, 'Read the Premise'),
            h('button', { className: 'tww-btn tww-btn-outline', onClick: () => scrollTo('tww-party') }, 'Meet the Party')
          )
        ),

        // Meet the Party Section (moved above Premise)
        h('section', { className: 'tww-party-section', id: 'tww-party' },
          h('h3', null, 'Meet the Party'),
          h('p', { className: 'tww-party-subtitle' }, 'Five souls bound together at the edge of a fading miracle.'),
          h('p', { className: 'tww-party-intro' }, 'They did not choose the age they were born into \u2014 only what they will become within it.'),

          // Carousel
          h('div', {
            className: 'tww-carousel',
            onMouseEnter: () => setHovered(true),
            onMouseLeave: () => setHovered(false)
          },
            h('button', { className: 'tww-carousel-arrow tww-arrow-left', onClick: goLeft, 'aria-label': 'Previous character' }, '\u2039'),
            h('div', { className: 'tww-carousel-track' },
              partyMembers.map((member, i) => {
                const pos = getPos(i);
                const isCenter = pos === 0;
                const absPos = Math.abs(pos);
                const visible = absPos <= 2;
                return h('div', {
                  key: member.name,
                  className: `tww-carousel-card ${isCenter ? 'tww-carousel-center' : ''} ${!visible ? 'tww-carousel-hidden' : ''}`,
                  style: {
                    transform: `translateX(${pos * 350}px) scale(${isCenter ? 1 : 0.48})`,
                    zIndex: 10 - absPos,
                    opacity: visible ? (isCenter ? 1 : 0.55 - (absPos - 1) * 0.2) : 0,
                    filter: isCenter ? 'none' : 'brightness(0.6) saturate(0.5)'
                  },
                  onClick: () => setCarouselIndex(i)
                },
                  h('div', { className: 'tww-carousel-img-wrap' },
                    h('img', {
                      src: member.image,
                      alt: member.name,
                      className: 'tww-carousel-img',
                      loading: 'lazy'
                    })
                  ),
                  isCenter && h('h4', { className: 'tww-char-name' }, member.name),
                  isCenter && h('p', { className: 'tww-char-meta' }, `Level ${member.level} ${member.race}`),
                  isCenter && h('p', { className: 'tww-char-meta' }, member.classInfo),
                  isCenter && h('p', { className: 'tww-char-player' }, `Played by ${member.player}`)
                );
              })
            ),
            h('button', { className: 'tww-carousel-arrow tww-arrow-right', onClick: goRight, 'aria-label': 'Next character' }, '\u203A')
          ),

          // Detail panel for the active character
          h('div', { className: 'tww-carousel-detail' },
            h('p', { className: 'tww-char-hook' }, `\u201C${partyMembers[carouselIndex].hook}\u201D`),
            h('p', { className: 'tww-char-bio' }, partyMembers[carouselIndex].bio)
          ),

          h('p', { className: 'tww-party-composition' }, 'Sorcerer (Dreamweave) \u2022 Barbarian/Druid (Wild Heart / Moon) \u2022 Paladin (Redemption) \u2022 Cleric (Grave) \u2022 Rogue (Arcane Trickster)'),
          h('p', { className: 'tww-party-closing' }, 'Different vows. Different wounds. One road \u2014 into the silence.')
        ),

        // Premise Section
        h('section', { className: 'tww-premise-section', id: 'tww-premise' },
          h('h3', null, 'Premise'),
          h('div', { className: 'tww-premise-body' },
            h('p', null, 'This is Sefara \u2014 a land where faith has long shaped law, and where wonders once breathed through every stone.'),
            h('p', null, 'Empires and kingdoms were raised by prophecy, and the stars themselves were said to bend at the sound of a prayer. Pilgrims still cross the Dawat Desert chasing visions, and in the frozen reaches of the Vel\'Carmin Range the devout carve their vows into ice that will never melt.'),
            h('p', null, 'For as long as memory can reach, the divine has answered. Cathedrals across the Empire of Ram\'rodun gleamed with living light, relics sang when touched, and magic was the breath of belief made visible.'),
            h('p', null, 'But now, something is fading. Torches sputter though the oil is fresh. Prayers return in silence. Spells misfire without cause.'),
            h('p', null, 'In markets and taverns, whispers tell of charms that crumble and of relics that shine only to gutter to ash. The learned call it a crisis of faith. Sailors across the Drake Sea speak of hollow winds; zealots dream of dawns that never come.'),
            h('p', null, 'Beneath every sermon and silence hums one truth: something vast and ancient stirs once more \u2014 and the very breath of wonder may soon slip away.')
          )
        ),

        // DM Notes Section
        h('section', { className: 'tww-dm-notes-section', id: 'tww-dm-notes' },
          h('h3', null, 'DM Notes (Public)'),
          h('p', { className: 'tww-dm-notes-intro' }, 'A few truths about this story, spoken plainly.'),
          h('div', { className: 'tww-dm-notes-body' },
            h('p', null, 'The Waning Wonder is a story of belief and consequence \u2014 what it means to live in a world where faith and magic are threads of the same weave.'),
            h('p', null, h('strong', null, 'Faith and Doubt: '), 'In Sefara, reverence and rejection are two sides of the same act of questioning (as well as indifference). The gods may listen \u2014 or they may not \u2014 but every mortal must decide what fills that silence.'),
            h('p', null, h('strong', null, 'Mystery and Power: '), 'The laws of reality are fraying. What will you cling to when miracles fail?'),
            h('p', null, h('strong', null, 'Politics and Intrigue: '), 'Faith shapes power, and skepticism can be as dangerous as heresy.'),
            h('p', null, h('strong', null, 'Exploration and Discovery: '), 'Across deserts, peaks, and ruins, every revelation demands a choice: what do you believe, and what will you sacrifice to prove it?')
          )
        ),

        // At-a-Glance Strip
        h('section', { className: 'tww-glance-section', id: 'tww-glance' },
          h('div', { className: 'tww-glance-strip' },
            h('div', { className: 'tww-glance-item' },
              h('span', { className: 'tww-glance-label' }, 'Setting'),
              h('span', { className: 'tww-glance-value' }, 'Sefara (Empire of Ram\'rodun and beyond)')
            ),
            h('div', { className: 'tww-glance-item' },
              h('span', { className: 'tww-glance-label' }, 'Core Themes'),
              h('span', { className: 'tww-glance-value' }, 'Faith, doubt, wonder, consequence')
            ),
            h('div', { className: 'tww-glance-item' },
              h('span', { className: 'tww-glance-label' }, 'Tone'),
              h('span', { className: 'tww-glance-value' }, 'Mythic fantasy with creeping dread and political intrigue')
            ),
            h('div', { className: 'tww-glance-item' },
              h('span', { className: 'tww-glance-label' }, 'Play Style'),
              h('span', { className: 'tww-glance-value' }, 'Character-driven, narrative-forward, high-stakes choices')
            )
          )
        ),

        // Footer CTA
        h('section', { className: 'tww-footer-cta-section', id: 'tww-footer' },
          h('h3', null, 'The wonder is waning. The story begins.'),
          h('div', { className: 'tww-cta-body' },
            h('p', null, 'Some will seek answers. Some will seek power. Some will seek forgiveness.'),
            h('p', null, 'But all of them will be tested by the same question:'),
            h('p', null, h('strong', null, 'What do you do when the world stops answering?'))
          ),
          h('div', { className: 'tww-cta-buttons' },
            h('button', { className: 'tww-btn', onClick: () => scrollTo('tww-party') }, 'Meet the Party'),
            h('button', { className: 'tww-btn tww-btn-outline', onClick: () => onNavigate('recaps') }, 'Session Recaps')
          )
        )
      );
    }

    // Main App Component
    function App() {
      const [currentView, setCurrentView] = useState('home');
      const [selectedCampaign, setSelectedCampaign] = useState(null);
      const [isUnlocked, setIsUnlocked] = useState(false);

      const handleEnterCampaign = (campaign) => {
        setSelectedCampaign(campaign);
        setCurrentView('password');
        setIsUnlocked(false);
      };

      const handleUnlock = () => {
        setIsUnlocked(true);
        setCurrentView('dashboard');
      };

      const handleBackHome = () => {
        setCurrentView('home');
        setSelectedCampaign(null);
        setIsUnlocked(false);
      };

      return h('div', { className: 'app' },
        currentView === 'home' && h(HomePage, { onEnterCampaign: handleEnterCampaign }),
        currentView === 'password' && selectedCampaign && h(PasswordGate, {
          campaign: selectedCampaign,
          onUnlock: handleUnlock,
          onBack: handleBackHome
        }),
        currentView === 'dashboard' && selectedCampaign && h(CampaignDashboard, {
          campaign: selectedCampaign,
          onBack: handleBackHome
        })
      );
    }
    
    const container = document.getElementById('root');
    const root = ReactDOM.createRoot(container);
    root.render(h(App));
  </script>
</body>
</html>
